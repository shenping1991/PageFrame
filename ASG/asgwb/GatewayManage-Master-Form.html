<!DOCTYPE html>
<html lang="ch">
<head>
    <meta charset="UTF-8">
    <title>主备设置</title>

    <!--全局通用!-->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="css/global.css">
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/doT.min.js"></script>

    <!--全局通用end!-->

    <!--[if lt IE 9]>
    <script src="js/html5shiv/html5shiv.js"></script>
    <script src="js/respond/respond.min.js"></script>
    <![endif]-->

</head>
<body>
<div class="dsm-rightside home">
    <div class="mainnav">
        <div class="urlindex">
            <i class="icon icon-home"></i>
            <a class="name dsmfontblue" href="home.html">首页</a>
            <i class="icon icon-right"></i>
            <a class="name dsmfontblue" href="javascript:void(0);">网关热备管理</a>
            <i class="icon icon-curright"></i>
            <span class="curname">主备设置</span>
        </div>
    </div>
    <div class="maincontent">
        <div class="mainbox clearfix">

            <div class="card-info width100 ">
                <div class="carditem dis-wrap">
                    <h5 class="card-info-header">参数设置</h5>

                    <div class="card-info-body" >
                        <div class="manage-contain ">
                            <div class="dsm-inline">
                                <label class="dsm-form-label ">启动管理：</label>
                                <div class="dsm-input-inline">
                                    <div class="dsm-radio-one">
                                        <div class="dsm-radiobox ">
                                            <input type="radio" id="serverStart" name="servertype" value="0" class="dsm-radio"  >
                                            <label for="serverStart"></label>
                                        </div>
                                        <label class="radiolabel" for="serverStart">启用</label>
                                    </div>

                                    <div class="dsm-radio-one">
                                        <div class="dsm-radiobox ">
                                            <input type="radio" id="serverStop" name="servertype" value="1" class="dsm-radio" checked >
                                            <label for="serverStop"></label>
                                        </div>
                                        <label class="radiolabel" for="serverStop">停用</label>
                                    </div>
                                </div>
                            </div>


                            <div class="item-header">主从设置<em>*</em></div>

                                <div class="dsmForms ">
                                    <div class="dis-mark marked">
                                    <div class="dsm-form-item">
                                        <div class="dsm-inline">
                                            <label class="dsm-form-label ">网关主备模式：</label>
                                            <div class="dsm-input-inline">
                                                <div class="dsm-radio-one">
                                                    <div class="dsm-radiobox">
                                                        <input type="radio" id="gmaster" name="gatewaytype" value="0" class="dsm-radio" checked="">
                                                        <label for="gmaster"></label>
                                                    </div>
                                                    <label class="radiolabel" for="gmaster">主用模式-Master</label>
                                                </div>

                                                <div class="dsm-radio-one">
                                                    <div class="dsm-radiobox">
                                                        <input type="radio" id="gbackup" name="gatewaytype" value="1" class="dsm-radio">
                                                        <label for="gbackup"></label>
                                                    </div>
                                                    <label class="radiolabel" for="gbackup">备用模式-Backup</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="dsm-inline">
                                            <label class="dsm-form-label">组名值设置：</label>
                                            <div class="dsm-input-inline">
                                                <input type="text" autocomplete="off" placeholder="51" class="dsm-input w100">
                                                <div class="dsm-tip-r">备注：默认值51；同一组的主备节点,组名值设置必须一致。</div>
                                            </div>

                                        </div>
                                        <div class="dsm-inline">
                                            <label class="dsm-form-label">绑定网卡：</label>
                                            <div class="dsm-input-inline">
                                                <select  class="dsm-select w100"  data-live-search="true">
                                                    <option>eth1</option>
                                                    <option>eth2</option>
                                                    <option>eth3</option>

                                                </select>
                                                <div class="dsm-tip-r">备注：绑定虚拟IP的网络接口；请选择默认路由所对应的网络接口。</div>
                                            </div>
                                        </div>
                                    </div>
                                    </div>
                            </div>
                        </div>
                        <div class="manage-contain ">
                            <div class="item-header">虚拟IP设置<em>*</em></div>
                            <div class="dsmForms ">
                                <div class="dis-mark marked">

                                <div class="dsm-form-item">
                                    <div class="dsm-inline">
                                        <div class="btn-toolbar">
                                            <button type="button" class="btn btn-primary whitebg js_add"><i class="btnicon icon icon-add-blue"></i>增加</button>
                                            <button type="button" class="btn btn-primary whitebg js_del"><i class="btnicon icon icon-del-blue"></i>删除</button>
                                        </div>
                                    </div>
                                    <div class="dsm-inline">
                                        <div class="dsm-input-block IPsetTable">
                                            <table  class="table" cellspacing="0" width="100%">
                                                <thead>
                                                <tr>
                                                    <th class="w50">
                                                        <div class="dsmcheckbox">
                                                            <input type="checkbox" value="1" id="t2"  class="js_checkboxAll" data-allcheckfor="uids"  name="">
                                                            <label for="t2"></label>
                                                        </div>
                                                    </th>
                                                    <th class="w20p">虚拟IP地址</th>
                                                    <th>描述</th>
                                                </tr>
                                                </thead>
                                                <tbody id="table_IPset">
                                                <tr class="t_tr" data-id="1">
                                                    <td>
                                                        <div class="dsmcheckbox">
                                                            <input type="checkbox" value="1" id="1" name="uids">
                                                            <label for="1"></label>
                                                        </div>
                                                    </td>
                                                    <td class="txt-blue">0.0.0.0</td>
                                                    <td>-</td>
                                                </tr>
                                                <tr class="t_tr" data-id="2">
                                                    <td>
                                                        <div class="dsmcheckbox">
                                                            <input type="checkbox" value="2" id="2" name="uids">
                                                            <label for="2"></label>
                                                        </div>
                                                    </td>
                                                    <td class="txt-blue">192.168.0.2</td>
                                                    <td>-</td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="dsm-tip">备注：主备节点的虚拟IP值设置必须一样，默认只需设置一个虚拟IP。</div>

                                    </div>
                                </div>
                                </div>
                            </div>

                        </div>
                        <div class="form-btns padding-l-0">
                            <button type="button" class="btn btn-lg btn-primary js_saveAll m-l-30">保存 <i class="icon icon-load hidden"></i> </button>

                        </div>
                    </div>
                </div>

            </div>
            <div class="card-info width100 ">
                <div class="carditem dis-wrap">
                    <h5 class="card-info-header">服务管理</h5>
                    <div class="dis-mark marked">
                    <div class="card-info-body" >
                    <div class="form-btns padding-l-0 m-l-30">
                        <button type="button" class="btn btn-lg btn-primary js_start">HA服务启动 <i class="icon icon-load hidden"></i> </button>
                        <button type="button" class="btn btn-lg btn-primary js_stop">HA服务停止<i class="icon icon-load hidden"></i></button>
                        <button type="button" class="btn btn-lg btn-primary js_restart">HA服务重启<i class="icon icon-load hidden"></i></button>
                    </div>
                    </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<!--新增-->
<div id="addNetForm" style="display: none">
    <div class="dsmForms">
        <div class="dsm-form-item">
            <div class="dsm-inline">
                <label class="dsm-form-label">虚拟IP地址：</label>
                <div class="dsm-input-inline ">
                    <input id="txt_IPAddress" type="text" autocomplete="off" placeholder="" class="dsm-input">
                </div>
                <div class="desc"><em>*</em>必填</div>
                <div class="line-tip error"><i class="icon icon-error"></i>虚拟IP地址不能为空</div>
            </div>
            <div class="dsm-inline">
                <label class="dsm-form-label">描述：</label>
                <div class="dsm-input-inline ">
                    <textarea name="" id="txt_desc" cols="10" rows="2" class="dsm-textarea"></textarea>
                </div>
            </div>
        </div>
    </div>
</div>
<!--//提示-操作失败-->
<div class="btn-failTip-close"></div>
<div class="alert-box failTip hidden">
    <div class="alert-con failTip-content">
        <i class="alert-con-ico failTip-ico alert-con-ico-fail"></i>
        <span class="alert-txt failTip-txt"></span>

    </div>
</div>
<!--//提示-操作成功-->
<div class="alert-box sucTip hidden">
    <div class=" alert-con sucTip-content">
        <i class="alert-con-ico sucTip-ico alert-con-ico-suc"></i>
        <span class="alert-txt sucTip-txt"></span>
    </div>
</div>

<script id="tr_template" type="text/x-dot-template">
    <tr class="t_tr" data-id="{id}">
        <td>
            <div class="dsmcheckbox">
                <input type="checkbox" value="{id}" id="{id}" name="uids">
                <label for="{id}"></label>
            </div>
        </td>
        <td class="txt-blue t_txt_IP"></td>
        <td class="t_txt_desc"></td>
    </tr>
</script>
<script type="text/javascript" src="js/site.js"></script>
<script src="js/selectivizr.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        //新增虚拟IP
        $(document).on('click', '.js_add', function (e) {
            removeAllErrorTip();
            dsmDialog.open({
                type: 1,
                area:['560px','400px'],
                btn:['增加','取消'],
                title:"增加虚拟IP地址",
                content: $('#addNetForm'),
                yes: function(index, layero){
                    var IPCheck=checkIPIsNull();
                    if(IPCheck){
                        var IP=$("#txt_IPAddress").val();
                        var desc=$("#txt_desc").val();
                        dsmDialog.msg('新增成功!');
                        dsmDialog.close(index);
                        var tpl = document.getElementById("tr_template").text;
                        var count = $(".table>tbody>tr").length;
                        $('#table_IPset').append(tpl.replace(/\{id}/g, ( parseInt(count) + 1)));
                        var obj=$(".t_tr[data-id='"+(parseInt(count) + 1)+"']");
                        $(obj).find(".t_txt_IP").html(IP);
                        $(obj).find(".t_txt_desc").html(desc);
//                        $("#txt_IPAddress").val("");
//                        $("#txt_desc").val("");
                        clear();
                        //初始化输入控件
                        function clear(){
                            $(".dsm-input").val("");
                            $(".dsm-textarea").val("");

                        }
                    }
                    else{
                        $("#txt_IPAddress").parent().next().next('.line-tip').css('display','block');
                    }
                }
            });
        });
        var chkItem="";//记录当前选中项

        //删除虚拟IP
        $(document).on('click', '.js_del', function (e) {
            chkItem=itemSelected_check("uids");
            if(chkItem.length==0){
                dsmDialog.error('请先选择虚拟IP！');
                return;
            }
            showDelModel();
        });
        //删除弹框
        function showDelModel() {
            dsmDialog.toComfirm("请确认是否删除当前虚拟IP设置！", {
                btn: ['确定','取消'],
                title:"删除"
            }, function(index){
                //删除操作代码
                var ids=chkItem.split(",") ;
                for (var i = 0 ; i <ids.length; i++) {
                    var obj=$("input[name='uids'][value='"+JSON.parse(ids[i]).id+"'");
                    $(obj).parents().find(".t_tr[data-id="+JSON.parse(ids[i]).id+"]").remove();
                }
                dsmDialog.msg('删除成功！');
                dsmDialog.close(index);
            }, function(index){
                dsmDialog.close(index);
            });
        }
    })
    //服务管理启用禁用按钮动态效果
    $(document).on('click',"input[name='servertype']",function(e){
        var serverTypeVal = $("input[name='servertype']:checked").val();
        if (serverTypeVal == 1) {

            $('.dis-mark').addClass('marked');
            $('.dis-mark').children().find('input[type=radio]').attr('disabled','disabled');
            $('.dis-mark').children().find('input[type=text]').attr('disabled','disabled');
            $('.dis-mark').children().find('input[type=checkbox]').attr('disabled','disabled');
            $('.dis-mark').children().find('select').attr('disabled','disabled');
            $('.dis-mark').children().find('button').attr('disabled','disabled');


        }
        if (serverTypeVal == 0) {

            $('.dis-mark').removeClass('marked');
            $('.dis-mark').children().find('input[type=radio]').removeAttr('disabled');
            $('.dis-mark').children().find('input[type=text]').removeAttr('disabled');
            $('.dis-mark').children().find('input[type=checkbox]').removeAttr('disabled');
            $('.dis-mark').children().find('select').removeAttr('disabled');
            $('.dis-mark').children().find('button').removeAttr('disabled');

        }
    });

    //提示-关闭失败提示
    $(document).on('click','.btn-failTip-close',function (e) {
        $(this).parent().parent(".failTip").addClass("hidden");
    })

    //HA服务启动
    $(document).on("click",".js_start",function(){
        checkIPSet();//虚拟IP列表为空情况下点击按钮
        //出现加载图标
        $(this).children(".icon-load").removeClass("hidden");
        setTimeout(function () {
            $(".icon-load").addClass("hidden");
        },200);
        setTimeout(function () {
            oprSuccess("HA服务启动成功");
        },200)
        setTimeout(function () {
            oprFail("HA服务启动失败","m1","");
        },200)

    })
    //HA服务停止
    $(document).on("click",".js_stop",function(){
        checkIPSet();
        $(this).children(".icon-load").removeClass("hidden");
        setTimeout(function () {
            $(".icon-load").addClass("hidden");
        },200);
        setTimeout(function () {
            oprSuccess("HA服务已停止");
        },200)
        setTimeout(function () {
            oprFail("HA服务停止失败","m2","");
        },200)
    })
    //HA服务重启
    $(document).on("click",".js_restart",function(){
        checkIPSet();
        $(this).children(".icon-load").removeClass("hidden");
        setTimeout(function () {
            $(".icon-load").addClass("hidden");
        },200);
        setTimeout(function () {
            oprSuccess("HA服务已重启");
        },200)
        setTimeout(function () {
            oprFail("HA服务重启失败","m3","");
        },200)
    })

    //虚拟IP列表为空
    function checkIPSet(){
        var len = $(".table>tbody>tr").length;
        if(len<1){
            dsmDialog.error('未输入虚拟IP地址！');
        }
    }
    //新增-检查IP是否填写
    $(document).on("blur","#txt_IPAddress",function(){
        if(checkIPIsNull()){
            removeErrorTip(this);
        }

    })
    function checkIPIsNull() {
        var IPAddress=$.trim($("#txt_IPAddress").val());
        if(IPAddress==""){

            return false;
        }
        else{
            return true;
        }
    }
    //新增-移除错误提示
    function removeErrorTip(obj) {
        $(obj).parent().next().next('.line-tip').css('display','none');
    }
    function removeAllErrorTip() {
        $('.line-tip').css('display','none');
    }
</script>
</body>
</html>